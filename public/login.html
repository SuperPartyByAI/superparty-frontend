<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <title>SuperParty - Autentificare</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>
<body style="
  margin:0;
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:16px;
  font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
  background:radial-gradient(circle at top,#1d4ed8 0%,#0f172a 45%,#020617 100%);
  color:#e5e7eb;
">
  <div style="
    background:#020617cc;
    border-radius:18px;
    padding:24px 26px;
    max-width:400px;
    width:100%;
    box-shadow:0 20px 50px rgba(0,0,0,0.7);
    border:1px solid rgba(37,99,235,0.5);
  ">
    <h1 style="
      font-size:22px;
      margin:0 0 4px;
      text-align:center;
      letter-spacing:0.04em;
    ">SuperParty · Login</h1>
    <p style="
      font-size:13px;
      margin:0 0 20px;
      text-align:center;
      color:#9ca3af;
    ">Autentificare angajați · acces la evenimente și AI</p>

    <form id="loginForm">
      <label for="email" style="font-size:13px;display:block;margin-bottom:4px;">Email</label>
      <input id="email" type="email" required placeholder="ex: nume@superparty.ro" style="
        width:100%;
        padding:10px 11px;
        border-radius:10px;
        border:1px solid #1f2937;
        background:#020617;
        color:#e5e7eb;
        font-size:14px;
        margin-bottom:12px;
        outline:none;
      " />

      <label for="password" style="font-size:13px;display:block;margin-bottom:4px;">Parolă</label>
      <input id="password" type="password" required placeholder="Parola ta" style="
        width:100%;
        padding:10px 11px;
        border-radius:10px;
        border:1px solid #1f2937;
        background:#020617;
        color:#e5e7eb;
        font-size:14px;
        margin-bottom:12px;
        outline:none;
      " />

      <div style="
        display:flex;
        justify-content:flex-end;
        font-size:12px;
        margin-bottom:8px;
        color:#9ca3af;
      ">
        <span style="color:#60a5fa;cursor:pointer;" onclick="goToRegister()">Creează cont nou</span>
      </div>

      <button type="submit" id="loginBtn" style="
        width:100%;
        padding:10px 14px;
        border-radius:999px;
        border:none;
        background:linear-gradient(135deg,#3b82f6,#1d4ed8);
        color:#f9fafb;
        font-weight:600;
        font-size:15px;
        cursor:pointer;
        box-shadow:0 12px 30px rgba(37,99,235,0.6);
      ">
        Autentificare
      </button>
    </form>

    <div id="error" style="
      display:none;
      margin-top:10px;
      font-size:13px;
      color:#f97373;
    "></div>

    <p style="
      margin-top:14px;
      font-size:11px;
      text-align:center;
      color:#6b7280;
    ">
      SuperParty · acces doar pentru colaboratori validați.
    </p>
  </div>

  <script>
    const BACKEND_URL = "https://script.google.com/macros/s/AKfycbxs819m4gt-tpTkAIIS91EnxhwYx-5wdbnh6Zi5_GcY14zs5XYqS9ykFuYCCcokhQ/exec";

    function goToRegister() {
      window.location.href = "/register/";
    }

    function showError(msg) {
      const el = document.getElementById("error");
      el.textContent = msg || "Eroare la autentificare.";
      el.style.display = "block";
    }

    function hideError() {
      const el = document.getElementById("error");
      el.style.display = "none";
    }

    function setLoading(isLoading) {
      const btn = document.getElementById("loginBtn");
      btn.disabled = isLoading;
      btn.textContent = isLoading ? "Se autentifică..." : "Autentificare";
      btn.style.opacity = isLoading ? "0.7" : "1";
    }

    function handleLoginResponse(res) {
      setLoading(false);
      if (!res || !res.success) {
        showError(res && (res.error || res.message) ? (res.error || res.message) : "Email sau parolă incorecte.");
        return;
      }
      hideError();
      window.location.href = "/angajat/";
    }

    document.getElementById("loginForm").addEventListener("submit", function (e) {
      e.preventDefault();
      hideError();

      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value;

      if (!email || !password) {
        showError("Completează emailul și parola.");
        return;
      }

      setLoading(true);

      const cbName = "cbLogin_" + Date.now();
      window[cbName] = function (res) {
        try {
          handleLoginResponse(res);
        } finally {
          delete window[cbName];
        }
      };

      const url =
        BACKEND_URL +
        "?action=login" +
        "&email=" + encodeURIComponent(email) +
        "&password=" + encodeURIComponent(password) +
        "&callback=" + cbName;

      const s = document.createElement("script");
      s.src = url;
      s.onerror = function () {
        setLoading(false);
        showError("Nu se poate contacta serverul. Încearcă din nou.");
        delete window[cbName];
      };
      document.body.appendChild(s);
    });
  </script>
</body>
</html>
