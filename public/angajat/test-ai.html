<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <title>SuperParty - Test AI angajat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      min-height: 100vh;
      background: radial-gradient(circle at top, #1d4ed8 0, #0f172a 45%, #020617 100%);
      color: #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    .card {
      width: 100%;
      max-width: 480px;
      background: #020617;
      border-radius: 18px;
      border: 1px solid #1f2937;
      box-shadow: 0 22px 55px rgba(15, 23, 42, 0.7);
      padding: 18px 18px 14px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .badge-env {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: #f97316;
      margin-bottom: 2px;
    }

    .title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 2px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .title span.logo {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 26px;
      height: 26px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 0, #38bdf8 0, #1d4ed8 40%, #020617 100%);
      font-size: 14px;
      font-weight: 700;
    }

    .subtitle {
      font-size: 13px;
      color: #9ca3af;
      margin-bottom: 8px;
    }

    .input-row {
      margin-bottom: 8px;
    }

    label {
      font-size: 11px;
      color: #9ca3af;
      display: block;
      margin-bottom: 3px;
    }

    input, textarea {
      width: 100%;
      border-radius: 10px;
      border: 1px solid #1f2937;
      background: #020617;
      color: #e5e7eb;
      font-size: 13px;
      padding: 7px 9px;
      outline: none;
    }

    input::placeholder,
    textarea::placeholder {
      color: #6b7280;
    }

    textarea {
      resize: vertical;
      min-height: 60px;
      max-height: 120px;
    }

    .chat-box {
      margin-top: 4px;
      border-radius: 14px;
      border: 1px solid #1f2937;
      background: #020617;
      padding: 10px;
      max-height: 260px;
      overflow-y: auto;
      font-size: 13px;
    }

    .msg {
      margin-bottom: 8px;
      line-height: 1.4;
      white-space: pre-wrap;
    }

    .msg-user {
      text-align: right;
    }

    .msg-user span.bubble {
      display: inline-block;
      background: #1d4ed8;
      color: #e5e7eb;
      padding: 6px 10px;
      border-radius: 999px 0 999px 999px;
      max-width: 90%;
    }

    .msg-ai span.bubble {
      display: inline-block;
      background: #020617;
      border: 1px solid #1f2937;
      padding: 6px 10px;
      border-radius: 0 999px 999px 999px;
      max-width: 90%;
    }

    .status {
      font-size: 11px;
      color: #9ca3af;
      margin-top: 4px;
      min-height: 14px;
    }

    .actions {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 6px;
    }

    .actions button {
      border-radius: 999px;
      border: none;
      padding: 8px 14px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      background: linear-gradient(90deg, #2563eb, #4f46e5);
      color: white;
      flex-shrink: 0;
      min-width: 96px;
    }

    .actions button:disabled {
      opacity: 0.5;
      cursor: default;
    }

    .actions .fill {
      flex: 1;
    }

    .hint {
      margin-top: 6px;
      font-size: 11px;
      color: #6b7280;
    }
  </style>
</head>
<body>
  <div class="card">
    <div class="badge-env">ENV: TEST UI (backend PROD)</div>

    <div class="title">
      <span class="logo">AI</span>
      SuperParty – Chat angajat
    </div>

    <div class="subtitle">
      Aici testezi AI-ul SuperParty conectat la backend-ul actual. Ce scrii se salvează în foaia <strong>Chats</strong>.
    </div>

    <div class="input-row">
      <label for="email">Email angajat (folosit ca ID în istoricul de chat):</label>
      <input id="email" type="email" value="test@superparty.ro" />
    </div>

    <div class="input-row">
      <label for="message">Mesaj către SuperParty AI:</label>
      <textarea id="message" placeholder="Ex: ce dovezi trebuie să fac la EVT_001?"></textarea>
    </div>

    <div class="chat-box" id="chatBox"></div>

    <div class="status" id="statusLine"></div>

    <div class="actions">
      <div class="fill"></div>
      <button id="sendBtn">Trimite</button>
    </div>

    <div class="hint">
      Sugestie: încearcă <strong>„ce dovezi trebuie să fac la EVT_001?”</strong> sau <strong>„explică-mi pașii pentru dovezi bagaj / am ajuns / final”</strong>.
    </div>
  </div>

  <script>
    // BACKEND PROD ACTUAL
    const BACKEND_URL =
      "https://script.google.com/macros/s/AKfycbxs819m4gt-tpTkAIIS91EnxhwYx-5wdbnh6Zi5_GcY14zs5XYqS9ykFuYCCcokhQ/exec";

    const emailInput  = document.getElementById("email");
    const messageArea = document.getElementById("message");
    const chatBox     = document.getElementById("chatBox");
    const statusLine  = document.getElementById("statusLine");
    const sendBtn     = document.getElementById("sendBtn");

    function addMessage(role, text) {
      const div = document.createElement("div");
      div.className = "msg " + (role === "USER" ? "msg-user" : "msg-ai");

      const bubble = document.createElement("span");
      bubble.className = "bubble";
      bubble.textContent = text;

      div.appendChild(bubble);
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function setStatus(text) {
      statusLine.textContent = text || "";
    }

    async function sendToAi() {
      const email = (emailInput.value || "").trim();
      const msg   = (messageArea.value || "").trim();

      if (!email) {
        alert("Te rog introdu un email (poți folosi unul de test).");
        return;
      }
      if (!msg) {
        alert("Scrie un mesaj pentru AI.");
        return;
      }

      addMessage("USER", msg);
      messageArea.value = "";
      setStatus("Se trimite către AI...");
      sendBtn.disabled = true;

      try {
        const url =
          BACKEND_URL +
          "?action=chat_angajat" +
          "&email="   + encodeURIComponent(email) +
          "&message=" + encodeURIComponent(msg);

        const res = await fetch(url);
        const data = await res.json();

        if (!data.success) {
          const errText = data.error || "Eroare necunoscută de la backend.";
          addMessage("AI", "Eroare AI: " + errText);
          setStatus("Eroare AI. Vezi mesajul din chat.");
        } else {
          addMessage("AI", data.reply || "(răspuns gol)");
          setStatus("Răspuns primit de la AI.");
        }
      } catch (err) {
        addMessage("AI", "Eroare rețea / JS: " + err.message);
        setStatus("Eroare de rețea / browser.");
      } finally {
        sendBtn.disabled = false;
      }
    }

    sendBtn.addEventListener("click", sendToAi);

    messageArea.addEventListener("keydown", function (e) {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendToAi();
      }
    });

    // Mesaj de bun-venit
    addMessage(
      "AI",
      "Salut! Sunt SuperParty AI. Scrie-mi ce ai nevoie legat de dovezi, evenimente, KYC sau status cont. Ex: \"ce dovezi trebuie să fac la EVT_001?\""
    );
  </script>
</body>
</html>
