<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8">
  <title>Dashboard Angajat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body{background:#0f172a;color:#fff;font-family:Arial;padding:40px}
    .card{max-width:760px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);border-radius:14px;padding:18px 20px;margin-top:18px}
    .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12);font-size:13px}
    .ok{background:rgba(16,185,129,.18);border-color:rgba(16,185,129,.35)}
    .bad{background:rgba(239,68,68,.18);border-color:rgba(239,68,68,.35)}
    code{background:rgba(255,255,255,.08);padding:2px 6px;border-radius:6px}
  </style>

  <!-- IMPORTANT: auth-guard face TOT routing-ul (DB refresh via /api/auth/me). -->
  <script src="/angajat/auth-guard.js"></script>
</head>
<body>

  <h1>Dashboard Angajat</h1>
  <p id="headline">Se verifică accesul...</p>

  <div class="card">
    <div><strong>Debug (din localStorage după refresh-ul guard-ului)</strong></div>
    <div class="row" id="debugRow"></div>
    <div style="margin-top:12px;font-size:13px;opacity:.9">
      Dacă aici vezi <code>users.status: approved</code>, ești OK.
    </div>
  </div>

  <script>
    (function(){
      function safeParse(v){ try { return JSON.parse(v); } catch(e){ return null; } }

      var row = document.getElementById("debugRow");
      function pill(label, value, ok){
        var el = document.createElement("span");
        el.className = "pill " + (ok ? "ok" : "bad");
        el.textContent = label + ": " + (value || "(gol)");
        row.appendChild(el);
      }

      var token = localStorage.getItem("sp_token") || "";
      var u = safeParse(localStorage.getItem("sp_user") || "null") || {};

      var role = String(u.role || "").toLowerCase();
      var status = String(u.status || "").toLowerCase();

      pill("token_len", token ? String(token.length) : "0", !!token);
      pill("email", u.email || "", !!u.email);
      pill("role", role || "(gol)", !!role);
      pill("users.status", status || "(gol)", status === "approved");

      document.getElementById("headline").textContent =
        (status === "approved")
          ? "Ești OK (approved) ✅"
          : "Nu ești approved încă (sau nu s-a făcut refresh) …";
    })();
  </script>

</body>
</html>
