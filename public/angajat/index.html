<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <title>SuperParty - Dashboard angajat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      min-height: 100vh;
      background: radial-gradient(circle at top, #1d4ed8 0, #0f172a 45%, #020617 100%);
      color: #e5e7eb;
      display: flex;
      justify-content: center;
      padding: 16px;
    }

    .page {
      width: 100%;
      max-width: 1100px;
      background: rgba(15,23,42,0.9);
      border-radius: 18px;
      box-shadow: 0 24px 60px rgba(15,23,42,0.8);
      border: 1px solid rgba(148,163,184,0.25);
      padding: 18px 20px 26px;
      display: flex;
      flex-direction: column;
      gap: 18px;
      position: relative;
      overflow: hidden;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .header-left {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .hello {
      font-size: 20px;
      font-weight: 600;
    }

    .sub {
      font-size: 13px;
      color: #9ca3af;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 12px;
      color: #9ca3af;
    }

    .pill {
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.35);
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 2.1fr) minmax(0, 1.3fr);
      gap: 18px;
    }

    .card {
      background: #020617;
      border-radius: 14px;
      padding: 14px 14px 16px;
      border: 1px solid #1f2937;
      box-shadow: 0 16px 40px rgba(15,23,42,0.7);
    }

    .card-title {
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 6px;
    }

    .card-sub {
      font-size: 12px;
      color: #9ca3af;
      margin-bottom: 12px;
    }

    .stats-row {
      display: flex;
      gap: 8px;
      margin-top: 4px;
    }

    .stat-pill {
      flex: 1;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #1f2937;
      background: radial-gradient(circle at top left, #1d4ed8 0, #020617 60%);
      font-size: 11px;
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .stat-label {
      color: #9ca3af;
    }

    .stat-value {
      font-size: 13px;
      font-weight: 600;
    }

    .events-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 6px;
    }

    .event-item {
      border-radius: 12px;
      border: 1px solid #1f2937;
      background: radial-gradient(circle at top left, rgba(37,99,235,0.4) 0, #020617 60%);
      padding: 10px 10px 12px;
      font-size: 12px;
      cursor: pointer;
    }

    .event-title {
      font-size: 13px;
      font-weight: 500;
      margin-bottom: 2px;
    }

    .event-line {
      display: flex;
      gap: 10px;
      align-items: center;
      color: #9ca3af;
      margin-top: 2px;
    }

    .event-line span {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .event-id {
      font-size: 11px;
      color: #9ca3af;
      margin-top: 4px;
    }

    .event-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 8px;
      font-size: 11px;
    }

    .event-ai-btn {
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(37,99,235,0.25);
      border: 1px solid rgba(59,130,246,0.7);
      cursor: pointer;
    }

    .kyc-box {
      margin-top: 4px;
      padding: 10px;
      border-radius: 10px;
      background: linear-gradient(120deg, rgba(34,197,94,0.08), rgba(37,99,235,0.23));
      border: 1px solid rgba(34,197,94,0.5);
      font-size: 12px;
    }

    /* ================== AI CHAT FLOATING ================== */

    .ai-toggle-btn {
      position: fixed;
      right: 26px;
      bottom: 24px;
      width: 58px;
      height: 58px;
      border-radius: 999px;
      border: 2px solid rgba(59,130,246,0.9);
      background: radial-gradient(circle at 30% 0%, #38bdf8 0, #1d4ed8 35%, #020617 90%);
      box-shadow: 0 18px 40px rgba(15,23,42,0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 50;
    }

    .ai-toggle-btn span {
      font-size: 26px;
    }

    .ai-chat-wrapper {
      position: fixed;
      right: 20px;
      bottom: 24px;
      width: 320px;
      max-width: calc(100% - 40px);
      border-radius: 16px;
      background: #020617;
      border: 1px solid #1f2937;
      box-shadow: 0 24px 60px rgba(15,23,42,0.95);
      display: none;
      flex-direction: column;
      overflow: hidden;
      z-index: 60;
    }

    .ai-chat-header {
      padding: 10px 12px;
      border-bottom: 1px solid #111827;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      background: radial-gradient(circle at top left, rgba(37,99,235,0.7) 0, #020617 60%);
    }

    .ai-chat-header-left {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .ai-avatar {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      background: #020617;
      border: 1px solid rgba(191,219,254,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 15px;
    }

    .ai-header-text {
      display: flex;
      flex-direction: column;
      font-size: 11px;
    }

    .ai-header-text strong {
      font-size: 12px;
    }

    .ai-header-close {
      cursor: pointer;
      font-size: 16px;
      color: #e5e7eb;
    }

    .ai-chat-body {
      padding: 10px;
      max-height: 260px;
      overflow-y: auto;
      background: radial-gradient(circle at top, #020617 0, #020617 100%);
      display: flex;
      flex-direction: column;
    }

    .ai-msg {
      font-size: 12px;
      padding: 7px 9px;
      border-radius: 10px;
      margin-bottom: 6px;
      max-width: 92%;
      white-space: pre-wrap;
    }

    .ai-msg.ai {
      background: #020617;
      border: 1px solid #1f2937;
      align-self: flex-start;
    }

    .ai-msg.user {
      background: linear-gradient(135deg, #2563eb, #1d4ed8);
      border: 1px solid rgba(147,197,253,0.8);
      align-self: flex-end;
    }

    .ai-chat-footer {
      border-top: 1px solid #111827;
      padding: 8px;
      display: flex;
      gap: 6px;
      background: #020617;
    }

    .ai-chat-footer input {
      flex: 1;
      border-radius: 999px;
      border: 1px solid #1f2937;
      background: #020617;
      color: #e5e7eb;
      font-size: 12px;
      padding: 6px 10px;
      outline: none;
    }

    .ai-chat-footer button {
      border-radius: 999px;
      border: none;
      background: #2563eb;
      color: white;
      font-size: 12px;
      padding: 6px 10px;
      cursor: pointer;
    }

    .ai-hint {
      font-size: 10px;
      color: #6b7280;
      padding: 0 10px 6px;
    }

    @media (max-width: 800px) {
      .layout {
        grid-template-columns: minmax(0, 1fr);
      }
      .page {
        padding: 14px 12px 20px;
      }
      .ai-chat-wrapper {
        right: 10px;
        left: 10px;
        width: auto;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="header">
      <div class="header-left">
        <div class="hello">Salut, Andrei üëã</div>
        <div class="sub">Aici vezi evenimentele, KYC, contractul »ôi po»õi vorbi cu SuperParty AI.</div>
      </div>
      <div class="header-right">
        <div class="pill">Status cont: <span style="color:#22c55e;">Activ</span></div>
        <div class="pill">Rol: Angajat</div>
      </div>
    </div>

    <div class="layout">
      <!-- Col st√¢nga: evenimente -->
      <div class="card">
        <div class="card-title">Evenimentele tale</div>
        <div class="card-sub">Exemplu de evenimente (√Æn viitor le luƒÉm direct din Sheets)</div>

        <div class="stats-row">
          <div class="stat-pill">
            <div class="stat-label">Evenimente azi</div>
            <div class="stat-value">2</div>
          </div>
          <div class="stat-pill">
            <div class="stat-label">Weekend</div>
            <div class="stat-value">1</div>
          </div>
          <div class="stat-pill">
            <div class="stat-label">Dovezi lipsƒÉ</div>
            <div class="stat-value">3</div>
          </div>
        </div>

        <div class="events-list">
          <div class="event-item">
            <div class="event-title">Elsa 2h + Olaf 2h</div>
            <div class="event-line">
              <span>üìÖ Azi ¬∑ 15:00 - 17:00</span>
              <span>üìç Bucure»ôti, Sector 3</span>
            </div>
            <div class="event-id">ID: EVT_001 ¬∑ Rol principal: Anima»õie copii ¬∑ PlatƒÉ: 650 lei</div>
            <div class="event-actions">
              <span>‚ÑπÔ∏è ApasƒÉ mai jos pentru ajutor AI la dovezi.</span>
              <button class="event-ai-btn" onclick="openAIWithPrompt('Ce dovezi trebuie sƒÉ fac la EVT_001?')">√éntreabƒÉ AI despre dovezi</button>
            </div>
          </div>

          <div class="event-item">
            <div class="event-title">Spider-Man 2h</div>
            <div class="event-line">
              <span>üìÖ Azi ¬∑ 11:00 - 13:00</span>
              <span>üìç Bucure»ôti, Sector 4</span>
            </div>
            <div class="event-id">ID: EVT_002 ¬∑ Rol: Anima»õie copii ¬∑ PlatƒÉ: 350 lei</div>
            <div class="event-actions">
              <span>‚ÑπÔ∏è √éntreabƒÉ AI despre obligativitatea pozelor.</span>
              <button class="event-ai-btn" onclick="openAIWithPrompt('Ce poze obligatorii sunt la EVT_002?')">√éntreabƒÉ AI despre dovezi</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Col dreapta: rezumat + KYC -->
      <div class="card">
        <div class="card-title">Rezumat cont & KYC</div>
        <div class="card-sub">Aici vezi status KYC / contract »ôi po»õi cere clarificƒÉri AI-ului.</div>

        <div class="kyc-box">
          <strong>KYC & Contract</strong>
          <br />
          - Poza buletin: √ÆncƒÉrcatƒÉ ‚úÖ<br />
          - Contract digital: acceptat ‚úÖ<br />
          - Status verificare: √Æn regulƒÉ ‚úÖ
          <br /><br />
          Pentru √ÆntrebƒÉri, po»õi √Æntreba AI: ‚ÄûexplicƒÉ-mi KYC‚Äù sau ‚ÄûexplicƒÉ-mi contractul meu‚Äù.
        </div>
      </div>
    </div>
  </div>

  <!-- Buton AI (robot) -->
  <div class="ai-toggle-btn" id="aiToggleBtn" title="Deschide SuperParty AI">
    <span>ü§ñ</span>
  </div>

  <!-- Chat AI floating -->
  <div class="ai-chat-wrapper" id="aiChat">
    <div class="ai-chat-header">
      <div class="ai-chat-header-left">
        <div class="ai-avatar">ü§ñ</div>
        <div class="ai-header-text">
          <strong>SuperParty AI</strong>
          <span>√éntreabƒÉ-mƒÉ despre dovezi, KYC, contract, evenimente.</span>
        </div>
      </div>
      <div class="ai-header-close" id="aiCloseBtn">‚úï</div>
    </div>
    <div class="ai-chat-body" id="aiMessages">
      <div class="ai-msg ai">
        Salut! Sunt SuperParty AI. √é»õi pot rƒÉspunde la √ÆntrebƒÉri despre dovezi foto, KYC, contract sau status cont. Scrie-mi ce ai nevoie.
      </div>
    </div>
    <div class="ai-hint">
      Exemple: ‚Äûce dovezi trebuie la EVT_001?‚Äù, ‚ÄûexplicƒÉ-mi KYC‚Äù, ‚ÄûexplicƒÉ-mi contractul‚Äù.
    </div>
    <div class="ai-chat-footer">
      <input id="aiInput" type="text" placeholder="Scrie un mesaj cƒÉtre AI..." />
      <button id="aiSendBtn">Trimite</button>
    </div>
  </div>

  <script>
    // ================== CONFIG ==================
    const AI_API_URL = "https://superparty-ai-backend-production.up.railway.app/api/ai";

    // Email + mod utilizator - citim din localStorage dacƒÉ existƒÉ (setat de login)
    const userEmail = localStorage.getItem("userEmail") || "ursache.andrei1995@gmail.com";
    const userMode = localStorage.getItem("userMode") || "employee";

    // ================== UI ELEMENTE ==================
    const aiToggleBtn = document.getElementById("aiToggleBtn");
    const aiChat = document.getElementById("aiChat");
    const aiCloseBtn = document.getElementById("aiCloseBtn");
    const aiMessages = document.getElementById("aiMessages");
    const aiInput = document.getElementById("aiInput");
    const aiSendBtn = document.getElementById("aiSendBtn");

    function openAIChat() {
      aiChat.style.display = "flex";
      aiToggleBtn.style.display = "none";
      aiInput.focus();
    }

    function closeAIChat() {
      aiChat.style.display = "none";
      aiToggleBtn.style.display = "flex";
    }

    aiToggleBtn.addEventListener("click", openAIChat);
    aiCloseBtn.addEventListener("click", closeAIChat);

    // Deschide AI cu un mesaj presetat (din butonul de la evenimente)
    function openAIWithPrompt(promptText) {
      openAIChat();
      if (promptText) {
        aiInput.value = promptText;
        sendMessageToAI();
      }
    }
    window.openAIWithPrompt = openAIWithPrompt;

    // ================== LOGICA TRIMITERE MESAJ ==================

    function addMessage(text, from) {
      const div = document.createElement("div");
      div.className = "ai-msg " + (from === "user" ? "user" : "ai");
      div.textContent = text;
      aiMessages.appendChild(div);
      aiMessages.scrollTop = aiMessages.scrollHeight;
    }

    async function sendMessageToAI() {
      const message = aiInput.value.trim();
      if (!message) return;

      if (!userEmail) {
        addMessage("Eroare: nu e»ôti logat corect (lipse»ôte emailul).", "ai");
        return;
      }

      addMessage(message, "user");
      aiInput.value = "";
      aiInput.focus();

      aiSendBtn.disabled = true;
      aiSendBtn.textContent = "Se trimite...";

      try {
        const res = await fetch(AI_API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            email: userEmail,
            mode: userMode,
            message: message
          })
        });

        const data = await res.json();
        let reply = data.reply || JSON.stringify(data);

        // === DetectƒÉm comenzi speciale din rƒÉspunsul AI ===

        // Mod GM (token __MODE_GM__)
        if (reply.includes("__MODE_GM__")) {
          addMessage("Acces GM permis. Deschid modul GM din interfa»õƒÉ.", "ai");
          openGmMode();
          return;
        }

        // Mod ADMIN (token __MODE_ADMIN__), dacƒÉ vei folosi »ôi acest marker
        if (reply.includes("__MODE_ADMIN__")) {
          addMessage("Acces ADMIN permis. Deschid modul ADMIN din interfa»õƒÉ.", "ai");
          openAdminMode();
          return;
        }

        // RƒÉspuns normal
        addMessage(reply, "ai");
      } catch (err) {
        addMessage("Eroare la conectarea cu AI: " + err.message, "ai");
      } finally {
        aiSendBtn.disabled = false;
        aiSendBtn.textContent = "Trimite";
      }
    }

    aiSendBtn.addEventListener("click", sendMessageToAI);
    aiInput.addEventListener("keydown", function (e) {
      if (e.key === "Enter") {
        e.preventDefault();
        sendMessageToAI();
      }
    });

    // ================== FUNC»öII MODURI SPECIALE ==================

    function openGmMode() {
      // Aici decizi tu unde este modul GM.
      // De exemplu, o paginƒÉ separatƒÉ:
      window.location.href = "/gm/index.html";
    }

    function openAdminMode() {
      // Similar pentru modul ADMIN:
      window.location.href = "/admin/index.html";
    }
  </script>
</body>
</html>
