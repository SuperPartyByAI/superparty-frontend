<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <title>SuperParty - Dashboard angajat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      min-height: 100vh;
      background: radial-gradient(circle at top, #1d4ed8 0, #0f172a 45%, #020617 100%);
      color: #e5e7eb;
    }

    .hidden { display: none !important; }

    /* ============ KYC PAGE ============ */

    .kyc-page {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .kyc-card {
      width: 100%;
      max-width: 880px;
      background: rgba(15, 23, 42, 0.96);
      border-radius: 24px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      padding: 22px 22px 18px;
      box-shadow: 0 28px 60px rgba(15, 23, 42, 0.9);
    }

    .kyc-header {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 14px;
      flex-wrap: wrap;
    }

    .kyc-title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .kyc-subtitle {
      font-size: 12px;
      color: #9ca3af;
    }

    .kyc-badge {
      align-self: flex-start;
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(59, 130, 246, 0.7);
      background: rgba(37, 99, 235, 0.15);
      color: #bfdbfe;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .kyc-sections {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.1fr);
      gap: 16px;
    }

    @media (max-width: 880px) {
      .kyc-sections {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .kyc-section {
      background: rgba(15, 23, 42, 0.98);
      border-radius: 18px;
      border: 1px solid rgba(51, 65, 85, 0.95);
      padding: 14px 14px 10px;
    }

    .kyc-section h3 {
      font-size: 15px;
      margin-bottom: 4px;
    }

    .kyc-section p {
      font-size: 12px;
      color: #9ca3af;
      margin-bottom: 10px;
    }

    .checkbox-large {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 10px 11px;
      border-radius: 16px;
      border: 1px solid #475569;
      background: rgba(15, 23, 42, 0.9);
      cursor: pointer;
      font-size: 12px;
    }

    .checkbox-large input[type="checkbox"] {
      margin-top: 2px;
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    .upload-grid {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 10px;
    }

    @media (min-width: 760px) {
      .upload-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    .upload-card {
      border-radius: 16px;
      border: 1px dashed #4b5563;
      background: rgba(15, 23, 42, 0.9);
      padding: 10px 10px 9px;
      text-align: left;
      cursor: pointer;
      position: relative;
    }

    .upload-card:hover {
      border-color: #60a5fa;
      background: rgba(15, 23, 42, 0.96);
    }

    .upload-icon {
      font-size: 20px;
      margin-bottom: 2px;
    }

    .upload-title {
      font-size: 13px;
      font-weight: 500;
    }

    .upload-sub {
      font-size: 11px;
      color: #9ca3af;
    }

    .upload-required {
      font-size: 10px;
      color: #f97316;
      margin-top: 2px;
    }

    .upload-filename {
      font-size: 10px;
      color: #a7f3d0;
      margin-top: 3px;
      word-break: break-all;
    }

    .upload-card input[type="file"] {
      position: absolute;
      inset: 0;
      opacity: 0;
      cursor: pointer;
    }

    .driver-extra {
      margin-top: 10px;
      padding-top: 8px;
      border-top: 1px solid rgba(55, 65, 81, 0.9);
    }

    .kyc-footer {
      margin-top: 14px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .kyc-error {
      font-size: 12px;
      padding: 8px 10px;
      border-radius: 10px;
      background: rgba(248, 113, 113, 0.12);
      border: 1px solid rgba(248, 113, 113, 0.7);
      color: #fecaca;
      display: none;
    }

    .btn-primary {
      align-self: flex-start;
      padding: 9px 16px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #3b82f6, #22c55e);
      color: #f9fafb;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 10px 22px rgba(37, 99, 235, 0.5);
    }

    .btn-primary:disabled {
      opacity: 0.7;
      cursor: default;
      box-shadow: none;
    }

    /* ============ DASHBOARD ============ */

    .app-shell {
      display: flex;
      width: 100%;
      min-height: 100vh;
    }

    .sidebar-toggle {
      position: fixed;
      top: 14px;
      left: 14px;
      z-index: 1001;
      width: 34px;
      height: 34px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 18px;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.9);
    }

    .logout-btn {
      position: fixed;
      top: 14px;
      right: 14px;
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid rgba(248, 113, 113, 0.7);
      background: rgba(127, 29, 29, 0.9);
      color: #fee2e2;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      z-index: 1001;
    }

    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: 240px;
      height: 100vh;
      background: rgba(15, 23, 42, 0.98);
      border-right: 1px solid rgba(148, 163, 184, 0.35);
      padding: 16px 12px;
      transform: translateX(-260px);
      transition: transform 0.22s ease-out;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .sidebar.open {
      transform: translateX(0);
    }

    @media (min-width: 960px) {
      .sidebar {
        transform: translateX(0);
      }
    }

    .sidebar-logo {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 4px;
    }

    .sidebar-logo-badge {
      width: 30px;
      height: 30px;
      border-radius: 999px;
      background: linear-gradient(135deg, #38bdf8, #6366f1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 17px;
    }

    .sidebar-logo-text {
      display: flex;
      flex-direction: column;
      font-size: 12px;
    }

    .sidebar-logo-text span:first-child {
      color: #f9fafb;
      font-weight: 600;
    }

    .sidebar-logo-text span:last-child {
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-size: 10px;
    }

    .sidebar-section-title {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: #6b7280;
      margin: 8px 0 2px;
    }

    .sidebar-nav {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .sidebar-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 9px;
      border-radius: 10px;
      font-size: 13px;
      color: #e5e7eb;
      cursor: pointer;
      border: 1px solid transparent;
    }

    .sidebar-item span.icon {
      width: 22px;
      text-align: center;
      font-size: 15px;
    }

    .sidebar-item.active {
      background: radial-gradient(circle at top left, rgba(59, 130, 246, 0.25), transparent 60%);
      border-color: rgba(59, 130, 246, 0.7);
    }

    .sidebar-item:hover {
      background: rgba(30, 64, 175, 0.55);
    }

    .sidebar-footer {
      margin-top: auto;
      font-size: 11px;
      color: #6b7280;
      text-align: left;
    }

    .sidebar-footer strong {
      color: #e5e7eb;
    }

    .main {
      flex: 1;
      margin-left: 0;
      padding: 16px;
      padding-top: 60px;
      width: 100%;
      display: flex;
      justify-content: center;
    }

    @media (min-width: 960px) {
      .main {
        margin-left: 260px;
      }
    }

    .main-inner {
      width: 100%;
      max-width: 1200px;
      display: flex;
      gap: 16px;
      align-items: stretch;
    }

    .main-column {
      flex: 2;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .chat-column {
      flex: 3;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    @media (max-width: 900px) {
      .main-inner {
        flex-direction: column;
      }
      .main-column, .chat-column {
        flex: 1;
      }
    }

    .card {
      background: rgba(15, 23, 42, 0.96);
      border-radius: 20px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      padding: 14px 16px;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.8);
    }

    .header-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .header-subtitle {
      font-size: 12px;
      color: #9ca3af;
    }

    .chip-role {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(37, 99, 235, 0.2);
      border: 1px solid rgba(59, 130, 246, 0.7);
      font-size: 11px;
      color: #bfdbfe;
      margin-top: 6px;
    }

    /* CHAT */

    .chat-card {
      display: flex;
      flex-direction: column;
      height: calc(100vh - 100px);
      max-height: 720px;
    }

    .chat-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .chat-header-left {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .chat-avatar {
      width: 28px;
      height: 28px;
      border-radius: 999px;
      background: radial-gradient(circle at top left, #38bdf8, #6366f1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
    }

    .chat-title {
      font-size: 14px;
      font-weight: 600;
    }

    .chat-status {
      font-size: 11px;
      color: #22c55e;
    }

    .chat-body {
      flex: 1;
      border-radius: 16px;
      background: radial-gradient(circle at top left, rgba(30, 64, 175, 0.8), rgba(15, 23, 42, 0.98));
      padding: 10px;
      overflow-y: auto;
      border: 1px solid rgba(148, 163, 184, 0.3);
    }

    .msg {
      max-width: 80%;
      margin-bottom: 8px;
      padding: 8px 10px;
      border-radius: 12px;
      font-size: 13px;
      line-height: 1.4;
      word-wrap: break-word;
    }

    .msg.bot {
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(96, 165, 250, 0.7);
      border-bottom-left-radius: 2px;
    }

    .msg.user {
      margin-left: auto;
      background: linear-gradient(135deg, #22c55e, #16a34a);
      border-bottom-right-radius: 2px;
      color: #022c22;
      font-weight: 500;
    }

    .chat-footer {
      margin-top: 8px;
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .chat-input {
      flex: 1;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.95);
      color: #e5e7eb;
      font-size: 13px;
      outline: none;
    }

    .chat-input::placeholder {
      color: #6b7280;
    }

    .chat-btn {
      padding: 8px 14px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #3b82f6, #22c55e);
      color: #f9fafb;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .chat-btn:disabled {
      opacity: 0.6;
      cursor: default;
    }
  </style>
</head>
<body>
  <!-- KYC PAGE -->
  <div id="kycPage" class="kyc-page hidden">
    <div class="kyc-card">
      <div class="kyc-header">
        <div>
          <div class="kyc-title">ü™™ KYC & Contract de colaborare</div>
          <div class="kyc-subtitle">
            Pentru a activa contul de angajat, trebuie sƒÉ accep»õi contractul »ôi sƒÉ √Æncarci documentele obligatorii.
          </div>
        </div>
        <div class="kyc-badge">
          <span>‚úÖ FƒÇRƒÇ KYC = FƒÇRƒÇ PLATƒÇ</span>
        </div>
      </div>

      <div class="kyc-sections">
        <section class="kyc-section">
          <h3>üìÑ Contract & Accept</h3>
          <p>
            BifeazƒÉ cƒÉ ai citit »ôi accep»õi contractul de colaborare SuperParty. FƒÉrƒÉ aceastƒÉ bifƒÉ nu po»õi continua.
          </p>
          <label class="checkbox-large">
            <input type="checkbox" id="contractCheck" />
            <span>
              Confirm cƒÉ am citit »ôi accept contractul de colaborare SuperParty »ôi regulamentul intern.
            </span>
          </label>

          <div style="margin-top:10px;font-size:11px;color:#9ca3af;">
            DupƒÉ ce finalizezi acest pas, vei putea intra √Æn dashboard »ôi vei avea acces la evenimente, dovezi »ôi chat-ul AI.
          </div>
        </section>

        <section class="kyc-section">
          <h3>üë§ Documente obligatorii</h3>
          <p>UrmeazƒÉ exact pa»ôii. FƒÉrƒÉ aceste poze, plƒÉ»õile pot fi blocate automat de sistem.</p>

          <div class="upload-grid">
            <div class="upload-card">
              <div class="upload-icon">ü™™</div>
              <div class="upload-title">Buletin / CI (fa»õƒÉ + spate)</div>
              <div class="upload-sub">Poza clarƒÉ, toate datele vizibile.</div>
              <div class="upload-required">Obligatoriu pentru to»õi.</div>
              <div id="fileNameBuletin" class="upload-filename"></div>
              <input type="file" id="buletinUpload" accept="image/*,.pdf" />
            </div>

            <div class="upload-card">
              <div class="upload-icon">ü§≥</div>
              <div class="upload-title">Selfie cu buletinul</div>
              <div class="upload-sub">»öine CI l√¢ngƒÉ fa»õƒÉ, chipul clar.</div>
              <div class="upload-required">Obligatoriu pentru to»õi.</div>
              <div id="fileNameSelfie" class="upload-filename"></div>
              <input type="file" id="selfieUpload" accept="image/*" />
            </div>
          </div>

          <div style="margin-top:8px;">
            <label class="checkbox-large" style="margin-bottom:6px;">
              <input type="checkbox" id="driverCheck" />
              <span>‚úÖ Vreau sƒÉ fiu »ôi »ôofer (livrƒÉri, transport echipamente).</span>
            </label>

            <div class="driver-extra" id="driverExtra">
              <div style="font-size:11px;color:#9ca3af;margin-bottom:6px;">
                DacƒÉ bifezi op»õiunea de »ôofer, trebuie sƒÉ √Æncarci »ôi:
              </div>
              <div class="upload-grid">
                <div class="upload-card">
                  <div class="upload-icon">üöó</div>
                  <div class="upload-title">Permis de conducere (cat. B)</div>
                  <div class="upload-sub">Fa»õƒÉ + spate, vizibil.</div>
                  <div class="upload-required">Obligatoriu dacƒÉ e»ôti »ôofer.</div>
                  <div id="fileNamePermis" class="upload-filename"></div>
                  <input type="file" id="permisUpload" accept="image/*,.pdf" />
                </div>

                <div class="upload-card">
                  <div class="upload-icon">üìÑ</div>
                  <div class="upload-title">Cazier judiciar</div>
                  <div class="upload-sub">Emis √Æn ultimele 3 luni.</div>
                  <div class="upload-required">Obligatoriu dacƒÉ e»ôti »ôofer.</div>
                  <div id="fileNameCazier" class="upload-filename"></div>
                  <input type="file" id="cazierUpload" accept="image/*,.pdf" />
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>

      <div class="kyc-footer">
        <div id="kycError" class="kyc-error"></div>
        <button id="kycBtn" class="btn-primary">üöÄ FinalizeazƒÉ KYC »ôi intrƒÉ √Æn dashboard</button>
      </div>
    </div>
  </div>

  <!-- DASHBOARD PAGE -->
  <div id="dashboardPage" class="app-shell hidden">
    <button class="sidebar-toggle" id="toggleSidebar">‚ò∞</button>
    <button class="logout-btn" id="logoutBtn">Logout</button>

    <aside class="sidebar" id="sidebar">
      <div class="sidebar-logo">
        <div class="sidebar-logo-badge">üéâ</div>
        <div class="sidebar-logo-text">
          <span>SuperParty</span>
          <span>control panel</span>
        </div>
      </div>

      <div>
        <div class="sidebar-section-title">NAVIGARE</div>
        <ul class="sidebar-nav">
          <li class="sidebar-item active">
            <span class="icon">üí¨</span>
            <span>Chat AI</span>
          </li>
          <li class="sidebar-item">
            <span class="icon">üì∏</span>
            <span>Dovezi foto</span>
          </li>
          <li class="sidebar-item">
            <span class="icon">üéà</span>
            <span>Evenimente</span>
          </li>
          <li class="sidebar-item">
            <span class="icon">‚öôÔ∏è</span>
            <span>SetƒÉri cont</span>
          </li>
        </ul>
      </div>

      <div class="sidebar-footer">
        Logat ca<br />
        <strong id="sidebarUser">Angajat</strong><br />
        <span style="font-size:10px;">Rol: Angajat</span>
      </div>
    </aside>

    <main class="main">
      <div class="main-inner">
        <section class="main-column">
          <div class="card">
            <div class="header-title" id="welcomeTitle">Salut, Andrei üëã</div>
            <div class="header-subtitle" id="welcomeSubtitle">
              Ai acces la dashboardul tƒÉu. Aici vei vedea evenimentele, dovezile »ôi discu»õiile cu AI.
            </div>
            <div class="chip-role" id="roleChip">
              <span>üßë‚Äçüé§</span>
              <span>Rol: Angajat SuperParty</span>
            </div>
          </div>

          <div class="card">
            <div style="font-size:12px;color:#9ca3af;">
              Zona asta rƒÉm√¢ne momentan goalƒÉ. Mai t√¢rziu o folosim pentru evenimente, rezumate »ôi statistici.
            </div>
          </div>
        </section>

        <section class="chat-column">
          <div class="card chat-card">
            <div class="chat-header">
              <div class="chat-header-left">
                <div class="chat-avatar">ü§ñ</div>
                <div>
                  <div class="chat-title">SuperParty AI</div>
                  <div class="chat-status">Online ¬∑ rƒÉspunde instant</div>
                </div>
              </div>
            </div>

            <div class="chat-body" id="chatBody">
              <div class="msg bot">
                Salut! Sunt AI-ul SuperParty. √é»õi pot explica regulile de dovezi, ce poze sunt obligatorii »ôi cum se fac plƒÉ»õile.
              </div>
              <div class="msg bot">
                Po»õi √Æntreba de exemplu: <strong>"ExplicƒÉ-mi pozele obligatorii pentru Elsa"</strong> sau
                <strong>"Ce trebuie sƒÉ fac la bagaj?"</strong>
              </div>
            </div>

            <form class="chat-footer" id="chatForm">
              <input
                id="chatInput"
                class="chat-input"
                type="text"
                autocomplete="off"
                placeholder="Scrie aici √Æntrebarea ta pentru AI..."
              />
              <button class="chat-btn" id="chatSendBtn" type="submit">
                Trimite
              </button>
            </form>
          </div>
        </section>
      </div>
    </main>
  </div>

  <script>
    // ===== Helpers afi»ôare sec»õiuni =====
    const kycPage = document.getElementById('kycPage');
    const dashboardPage = document.getElementById('dashboardPage');

    function showKyc() {
      kycPage.classList.remove('hidden');
      dashboardPage.classList.add('hidden');
    }

    function showDashboard() {
      kycPage.classList.add('hidden');
      dashboardPage.classList.remove('hidden');
    }

    // ===== Init user din localStorage =====
    let currentUser = null;

    (function initUser() {
      try {
        const saved = localStorage.getItem('superparty_user');
        if (!saved) {
          window.location.href = '/login.html';
          return;
        }
        currentUser = JSON.parse(saved);

        const name = currentUser.name || currentUser.email || 'Angajat';
        document.getElementById('welcomeTitle').textContent = 'Salut, ' + name + ' üëã';
        document.getElementById('sidebarUser').textContent = name;

        const role = (currentUser.role || 'angajat').toLowerCase();
        const roleText =
          role === 'admin' ? 'Administrator SuperParty' :
          role === 'gm' ? 'General Manager SuperParty' :
          'Angajat SuperParty';
        document.getElementById('roleChip').children[1].textContent = 'Rol: ' + roleText;

        const localKyc = localStorage.getItem('superparty_kyc_done') === 'true';
        const backendKyc = !!currentUser.kyc_status && !!currentUser.contract_signed;

        if (localKyc || backendKyc) {
          showDashboard();
        } else {
          showKyc();
        }
      } catch (e) {
        console.error('Eroare la citirea userului:', e);
        localStorage.removeItem('superparty_user');
        window.location.href = '/login.html';
      }
    })();

    // ===== KYC logicƒÉ strictƒÉ =====
    const contractCheck = document.getElementById('contractCheck');
    const driverCheck = document.getElementById('driverCheck');
    const driverExtra = document.getElementById('driverExtra');

    const buletinInput = document.getElementById('buletinUpload');
    const selfieInput = document.getElementById('selfieUpload');
    const permisInput = document.getElementById('permisUpload');
    const cazierInput = document.getElementById('cazierUpload');

    const fileNameBuletin = document.getElementById('fileNameBuletin');
    const fileNameSelfie = document.getElementById('fileNameSelfie');
    const fileNamePermis = document.getElementById('fileNamePermis');
    const fileNameCazier = document.getElementById('fileNameCazier');

    function updateFileLabel(input, labelEl) {
      if (!input || !labelEl) return;
      if (input.files && input.files.length > 0) {
        labelEl.textContent = input.files[0].name;
      } else {
        labelEl.textContent = '';
      }
    }

    buletinInput.addEventListener('change', () => updateFileLabel(buletinInput, fileNameBuletin));
    selfieInput.addEventListener('change', () => updateFileLabel(selfieInput, fileNameSelfie));
    permisInput.addEventListener('change', () => updateFileLabel(permisInput, fileNamePermis));
    cazierInput.addEventListener('change', () => updateFileLabel(cazierInput, fileNameCazier));

    driverCheck.addEventListener('change', () => {
      if (driverCheck.checked) {
        driverExtra.style.opacity = '1';
        driverExtra.style.pointerEvents = 'auto';
      } else {
        driverExtra.style.opacity = '0.7';
        driverExtra.style.pointerEvents = 'none';
      }
    });

    const kycError = document.getElementById('kycError');
    const kycBtn = document.getElementById('kycBtn');

    function setKycError(message) {
      kycError.textContent = message;
      kycError.style.display = 'block';
    }

    function clearKycError() {
      kycError.textContent = '';
      kycError.style.display = 'none';
    }

    kycBtn.addEventListener('click', function() {
      clearKycError();

      if (!contractCheck.checked) {
        setKycError('Trebuie sƒÉ accep»õi contractul de colaborare √Ænainte sƒÉ continui.');
        return;
      }

      const hasBuletin = buletinInput.files && buletinInput.files.length > 0;
      const hasSelfie = selfieInput.files && selfieInput.files.length > 0;
      const isDriver = driverCheck.checked;
      const hasPermis = permisInput.files && permisInput.files.length > 0;
      const hasCazier = cazierInput.files && cazierInput.files.length > 0;

      if (!hasBuletin || !hasSelfie) {
        setKycError('Trebuie sƒÉ √Æncarci at√¢t poza de buletin (fa»õƒÉ+spate), c√¢t »ôi selfie-ul cu buletinul.');
        return;
      }

      if (isDriver && (!hasPermis || !hasCazier)) {
        setKycError('Ai bifat cƒÉ vrei sƒÉ fii »ôofer. Trebuie sƒÉ √Æncarci »ôi permisul de conducere »ôi cazierul judiciar.');
        return;
      }

      kycBtn.disabled = true;
      kycBtn.textContent = 'Se salveazƒÉ...';

      try {
        if (currentUser) {
          currentUser.kyc_status = true;
          currentUser.contract_signed = true;
          localStorage.setItem('superparty_user', JSON.stringify(currentUser));
        }
        localStorage.setItem('superparty_kyc_done', 'true');
      } catch (e) {
        console.warn('Nu am putut salva KYC local:', e);
      }

      setTimeout(() => {
        kycBtn.disabled = false;
        kycBtn.textContent = 'üöÄ FinalizeazƒÉ KYC »ôi intrƒÉ √Æn dashboard';
        showDashboard();
      }, 600);
    });

    // ===== Sidebar + logout =====
    const sidebar = document.getElementById('sidebar');
    const toggleSidebarBtn = document.getElementById('toggleSidebar');
    const logoutBtn = document.getElementById('logoutBtn');

    toggleSidebarBtn.addEventListener('click', () => {
      sidebar.classList.toggle('open');
    });

    logoutBtn.addEventListener('click', () => {
      try {
        localStorage.removeItem('superparty_user');
        localStorage.removeItem('superparty_kyc_done');
      } catch (e) {}
      window.location.href = '/login.html';
    });

    // ===== Chat AI (frontend demo + comenzi secrete) =====
    const chatForm = document.getElementById('chatForm');
    const chatBody = document.getElementById('chatBody');
    const chatInput = document.getElementById('chatInput');
    const chatSendBtn = document.getElementById('chatSendBtn');

    const OWNER_EMAIL = 'ursache.andrei1995@gmail.com';
    const ADMIN_PASSWORD = 'andrei-admin-2024';
    const GM_PASSWORD = 'andrei-gm-2024';

    function appendMessage(text, type) {
      const div = document.createElement('div');
      div.className = 'msg ' + type;
      div.innerHTML = text;
      chatBody.appendChild(div);
      chatBody.scrollTop = chatBody.scrollHeight;
    }

    function isOwnerUser() {
      if (!currentUser || !currentUser.email) return false;
      return String(currentUser.email).toLowerCase() === OWNER_EMAIL.toLowerCase();
    }

    function handleSecretCommand(rawText) {
      const text = rawText.trim().toLowerCase();
      if (text === 'open mod andrei admin') {
        if (!isOwnerUser()) {
          appendMessage('Nu ai permisiune sƒÉ intri √Æn modul de <strong>admin</strong>.', 'bot');
          return true;
        }
        const pwd = prompt('Introdu parola pentru modul de admin:');
        if (!pwd) {
          appendMessage('Comanda admin a fost anulatƒÉ.', 'bot');
          return true;
        }
        if (pwd !== ADMIN_PASSWORD) {
          appendMessage('ParolƒÉ gre»ôitƒÉ pentru modul de <strong>admin</strong>.', 'bot');
          return true;
        }
        window.location.href = '/admin/index.html';
        return true;
      }

      if (text === 'open mod andrei gm') {
        if (!isOwnerUser()) {
          appendMessage('Nu ai permisiune sƒÉ intri √Æn modul de <strong>GM</strong>.', 'bot');
          return true;
        }
        const pwd = prompt('Introdu parola pentru modul de GM:');
        if (!pwd) {
          appendMessage('Comanda GM a fost anulatƒÉ.', 'bot');
          return true;
        }
        if (pwd !== GM_PASSWORD) {
          appendMessage('ParolƒÉ gre»ôitƒÉ pentru modul de <strong>GM</strong>.', 'bot');
          return true;
        }
        window.location.href = '/gm/index.html';
        return true;
      }
      return false;
    }

    chatForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const text = chatInput.value.trim();
      if (!text) return;

      appendMessage(text.replace(/</g, '&lt;'), 'user');
      chatInput.value = '';
      chatInput.focus();

      chatSendBtn.disabled = true;

      // √Ænt√¢i verificƒÉm dacƒÉ este o comandƒÉ secretƒÉ
      if (handleSecretCommand(text)) {
        chatSendBtn.disabled = false;
        return;
      }

      // demo AI normal
      setTimeout(() => {
        appendMessage(
          'Am √Æn»õeles: <strong>' +
            text.replace(/</g, '&lt;') +
            '</strong>.<br/>Momentan sunt √Æn modul demo pe frontend. RƒÉspunsurile reale vor veni din AI-ul din backend.',
          'bot'
        );
        chatSendBtn.disabled = false;
      }, 500);
    });
  </script>
</body>
</html>
