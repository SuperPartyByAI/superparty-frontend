<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <title>SuperParty Angajat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body { margin:0; font-family:Arial; background:#f9fafb; }
    header { background:#6366f1; color:white; padding:16px; display:flex; justify-content:space-between; }
    #logoutBtn { background:white; color:#4338ca; border:none; padding:8px 14px; border-radius:6px; cursor:pointer; }
  </style>
</head>

<body>
    <div id="login" class="page active login-page">
        <div class="login-card">
            <h1 class="login-title">ğŸ‰ SuperParty Login</h1>
            <div id="loginError" class="error" style="display:none;"></div>
            <form id="loginForm">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="loginEmail" placeholder="ex: ana@superparty.ro" required />
                </div>
                <div class="form-group">
                    <label>ParolÄƒ</label>
                    <input type="password" id="loginPassword" placeholder="Introdu parola" required />
                </div>
                <button type="submit" class="btn" id="loginBtn">ğŸ”“ IntrÄƒ Ã®n aplicaÈ›ie</button>
            </form>
            <div class="link-toggle">
                Nu ai cont? <a href="#" onclick="event.preventDefault(); showPage('register');">ÃnregistreazÄƒ-te aici</a>
            </div>
        </div>
    </div>
    <div id="register" class="page register-page">
        <div class="register-card">
            <div style="text-align: center; margin-bottom: 40px;">
                <div style="font-size: 64px; margin-bottom: 15px;">âœ¨</div>
                <h2 style="font-size: 36px; font-weight: 700; color: #1f2937;">ÃnregistreazÄƒ-te</h2>
            </div>
            <div id="registerError" class="error" style="display:none;"></div>
            <form id="registerForm">
                <div class="form-group">
                    <label>ğŸ‘¨â€ğŸ’¼ Username</label>
                    <input type="text" id="registerUsername" placeholder="Alege un username" required />
                </div>
                <div class="form-group">
                    <label>ğŸ“§ Email</label>
                    <input type="email" id="registerEmail" placeholder="adresa@email.ro" required />
                </div>
                <div class="form-group">
                    <label>ğŸ”’ ParolÄƒ</label>
                    <input type="password" id="registerPassword" placeholder="Minim 8 caractere" required />
                </div>
                <button type="submit" class="btn" id="registerBtn" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">âœ¨ CreeazÄƒ cont</button>
            </form>
            <div class="link-toggle">
                Ai deja cont? <a href="#" onclick="event.preventDefault(); showPage('login');">Login aici</a>
            </div>
        </div>
    </div>
    <div id="kyc" class="page kyc-page">
        <div class="kyc-container">
            <h1 style="font-size: 42px; margin-bottom: 40px;">ğŸªª KYC Onboarding</h1>
            <div class="section">
                <h2 style="font-size: 24px; margin-bottom: 20px;">ğŸ“„ Contract de Colaborare</h2>
                <label class="checkbox-large">
                    <input type="checkbox" id="contractCheck" />
                    <span>Am citit È™i accept contractul de colaborare SuperParty</span>
                </label>
            </div>
            <div class="section">
                <h2 style="font-size: 24px; margin-bottom: 20px;">ğŸ‘¤ Documente de Identitate</h2>
                <p style="color: #94a3b8; margin-bottom: 20px;">Obligatoriu pentru toÈ›i angajaÈ›ii</p>
                <div class="upload-grid">
                    <label class="upload-card" for="buletinUpload">
                        <div style="font-size: 48px; margin-bottom: 10px;">ğŸªª</div>
                        <div style="font-weight: 600; margin-bottom: 5px;">Buletin / CI</div>
                        <div style="font-size: 12px; color: #94a3b8;">FaÈ›Äƒ + Spate</div>
                        <input type="file" id="buletinUpload" accept="image/*,.pdf" />
                    </label>
                    <label class="upload-card" for="selfieUpload">
                        <div style="font-size: 48px; margin-bottom: 10px;">ğŸ¤³</div>
                        <div style="font-weight: 600; margin-bottom: 5px;">Selfie cu Buletinul</div>
                        <div style="font-size: 12px; color: #94a3b8;">Chip vizibil + CI</div>
                        <input type="file" id="selfieUpload" accept="image/*" />
                    </label>
                </div>
            </div>
            <div class="section">
                <h2 style="font-size: 24px; margin-bottom: 20px;">ğŸš— Doresc sÄƒ fiu È˜ofer</h2>
                <label class="checkbox-large">
                    <input type="checkbox" id="driverCheck" onchange="toggleDriverSection()" />
                    <span>âœ… DA, vreau sÄƒ fiu È™i È™ofer (livrÄƒri, transport echipamente)</span>
                </label>
                <div id="driverDocs" class="driver-section">
                    <h3 style="font-size: 20px; margin-bottom: 20px; color: #818cf8;">ğŸ“‹ Documente È˜ofer (Obligatorii)</h3>
                    <div class="upload-grid">
                        <label class="upload-card" for="permisUpload">
                            <div style="font-size: 48px; margin-bottom: 10px;">ğŸªª</div>
                            <div style="font-weight: 600; margin-bottom: 5px;">Permis de Conducere</div>
                            <div style="font-size: 12px; color: #94a3b8;">Categoria B - FaÈ›Äƒ + Spate</div>
                            <input type="file" id="permisUpload" accept="image/*,.pdf" />
                        </label>
                        <label class="upload-card" for="cazierUpload">
                            <div style="font-size: 48px; margin-bottom: 10px;">ğŸ“„</div>
                            <div style="font-weight: 600; margin-bottom: 5px;">Cazier Judiciar</div>
                            <div style="font-size: 12px; color: #94a3b8;">Emis Ã®n ultimele 3 luni</div>
                            <input type="file" id="cazierUpload" accept="image/*,.pdf" />
                        </label>
                    </div>
                </div>
            </div>
            <button class="btn" onclick="completeKYC()" style="margin-top: 20px;">ğŸš€ FinalizeazÄƒ Onboarding</button>
        </div>
    </div>
    <div id="dashboard" class="page dashboard-page">
        <button class="logout-btn" onclick="logout()">ğŸšª Logout</button>
        <div class="dashboard-container">
            <div class="dashboard-header">
                <h1 style="font-size: 42px; margin-bottom: 10px;">ğŸ‘‹ Bine ai venit!</h1>
                <p style="color: #94a3b8; font-size: 18px;" id="welcomeText">Loading...</p>
            </div>
            <div class="tasks-grid">
                <div class="task-card">
                    <div style="font-size: 48px; margin-bottom: 15px;">ğŸ“…</div>
                    <h3 style="font-size: 24px; margin-bottom: 10px;">Task-uri AstÄƒzi</h3>
                    <p style="color: #94a3b8;">0 task-uri programate</p>
                </div>
                <div class="task-card">
                    <div style="font-size: 48px; margin-bottom: 15px;">ğŸ’°</div>
                    <h3 style="font-size: 24px; margin-bottom: 10px;">Profit Luna Asta</h3>
                    <p style="color: #94a3b8;">0 RON</p>
                </div>
                <div class="task-card">
                    <div style="font-size: 48px; margin-bottom: 15px;">â­</div>
                    <h3 style="font-size: 24px; margin-bottom: 10px;">Rating</h3>
                    <p style="color: #94a3b8;">5.0 / 5.0</p>
                </div>
            </div>
        </div>
    </div>
    <div id="admin" class="page admin-page">
        <button class="logout-btn" onclick="logout()">ğŸšª Logout</button>
        <div style="max-width: 1600px; margin: 0 auto; width: 100%;">
            <div class="card">
                <h1 style="font-size: 42px;">ğŸ”’ Admin Panel</h1>
            </div>
            <div class="card">
                <h2 style="margin-bottom: 20px;">Utilizatori</h2>
                <table>
                    <thead><tr><th>Nume</th><th>Email</th><th>Rol</th><th>KYC</th></tr></thead>
                    <tbody id="adminBody"></tbody>
                </table>
            </div>
        </div>
    </div>
    <div id="gm" class="page gm-page">
        <button class="logout-btn" onclick="logout()">ğŸšª Logout</button>
        <div style="max-width: 1600px; margin: 0 auto; width: 100%;">
            <div class="card">
                <h1 style="font-size: 42px;">ğŸ‘‘ GM Panel</h1>
                <p style="color: #94a3b8; margin-top: 20px;">Panel pentru General Manager</p>
            </div>
        </div>
    </div>
    <script>
        const BACKEND_URL = 'https://script.google.com/macros/s/AKfycbxs819m4gt-tpTkAIIS91EnxhwYx-5wdbnh6Zi5_GcY14zs5XYqS9ykFuYCCcokhQ/exec';
        let currentUser = null;
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            const el = document.getElementById(pageId);
            if (el) el.classList.add('active');
        }
        function toggleDriverSection() {
            const driverDocs = document.getElementById('driverDocs');
            const driverCheck = document.getElementById('driverCheck');
            if (driverCheck.checked) driverDocs.classList.add('show');
            else driverDocs.classList.remove('show');
        }
        function logout() {
            currentUser = null;
            localStorage.removeItem('superparty_user');
            showPage('login');
        }
        async function completeKYC() {
            if (!currentUser) return;
            currentUser.kyc_status = true;
            localStorage.setItem('superparty_user', JSON.stringify(currentUser));
            showPage('dashboard');
            document.getElementById('welcomeText').textContent = currentUser.name || currentUser.email;
        }
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            const btn = document.getElementById('loginBtn');
            const err = document.getElementById('loginError');
            btn.disabled = true;
            btn.textContent = 'Se Ã®ncarcÄƒ...';
            err.style.display = 'none';
            try {
                console.log('ğŸ” LOGIN - Email:', email);
                console.log('ğŸ” LOGIN - Backend URL:', BACKEND_URL);
                console.log('ğŸ” LOGIN - Request URL:', url);
                const url = `${BACKEND_URL}?action=login&email=${encodeURIComponent(email)}&password=${encodeURIComponent(password)}`;
                const response = await fetch(url);
                console.log('ğŸ” LOGIN - Response status:', response.status);
                console.log('ğŸ” LOGIN - Response headers:', response.headers);
                const result = await response.json();
                console.log('ğŸ” LOGIN - Backend result:', result);
                if (result.success) {
                    currentUser = result;
                    localStorage.setItem('superparty_user', JSON.stringify(result));
                    document.getElementById('welcomeText').textContent = result.name || result.email;
                    const role = (result.role || '').toLowerCase();
                    if (role === 'admin') {
                        showPage('admin');
                        loadAdminData();
                    } else if (role === 'gm') {
                        showPage('gm');
                    } else if (!result.kyc_status) {
                        showPage('kyc');
                    } else {
                        showPage('dashboard');
                    }
                } else {
                    err.textContent = 'âš ï¸ ' + (result.error || 'Email sau parolÄƒ greÈ™itÄƒ');
                    err.style.display = 'block';
                }
            } catch (error) {
                console.error('ğŸ”´ LOGIN - Error:', error);
                console.error('ğŸ”´ LOGIN - Error stack:', error.stack);
                err.textContent = 'âš ï¸ Eroare de conexiune: ' + error.message;
                err.style.display = 'block';
            }
            btn.disabled = false;
            btn.textContent = 'ğŸ”“ IntrÄƒ Ã®n aplicaÈ›ie';
        });
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('registerUsername').value.trim();
            const email = document.getElementById('registerEmail').value.trim();
            const password = document.getElementById('registerPassword').value;
            const btn = document.getElementById('registerBtn');
            const err = document.getElementById('registerError');
            btn.disabled = true;
            btn.textContent = 'Se creeazÄƒ...';
            err.style.display = 'none';
            try {
                console.log('ğŸ” LOGIN - Email:', email);
                console.log('ğŸ” LOGIN - Backend URL:', BACKEND_URL);
                console.log('ğŸ” LOGIN - Request URL:', url);
                const url = `${BACKEND_URL}?action=register&name=${encodeURIComponent(username)}&email=${encodeURIComponent(email)}&phone=0700000000&password=${encodeURIComponent(password)}`;
                const response = await fetch(url);
                console.log('ğŸ” LOGIN - Response status:', response.status);
                console.log('ğŸ” LOGIN - Response headers:', response.headers);
                const result = await response.json();
                console.log('ğŸ” LOGIN - Backend result:', result);
                if (result.success) {
                    alert('âœ… Cont creat! AÈ™teaptÄƒ aprobarea administratorului.');
                    showPage('login');
                } else {
                    err.textContent = 'âš ï¸ ' + (result.error || 'Eroare la creare cont');
                    err.style.display = 'block';
                }
            } catch (error) {
                console.error('ğŸ”´ LOGIN - Error:', error);
                console.error('ğŸ”´ LOGIN - Error stack:', error.stack);
                err.textContent = 'âš ï¸ Eroare de conexiune: ' + error.message;
                err.style.display = 'block';
            }
            btn.disabled = false;
            btn.textContent = 'âœ¨ CreeazÄƒ cont';
        });
        async function loadAdminData() {
            const tbody = document.getElementById('adminBody');
            tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;">Se Ã®ncarcÄƒ...</td></tr>';
            try {
                console.log('ğŸ” LOGIN - Email:', email);
                console.log('ğŸ” LOGIN - Backend URL:', BACKEND_URL);
                console.log('ğŸ” LOGIN - Request URL:', url);
                const url = `${BACKEND_URL}?action=getAllUsers`;
                const response = await fetch(url);
                console.log('ğŸ” LOGIN - Response status:', response.status);
                console.log('ğŸ” LOGIN - Response headers:', response.headers);
                const result = await response.json();
                console.log('ğŸ” LOGIN - Backend result:', result);
                if (result.success && result.users) {
                    tbody.innerHTML = result.users.map(u => `
                        <tr>
                            <td>${u.name}</td>
                            <td>${u.email}</td>
                            <td><span class="badge badge-active">${u.role}</span></td>
                            <td>${u.kyc_status ? 'âœ…' : 'âŒ'}</td>
                        </tr>
                    `).join('');
                }
            } catch (error) {
                console.error('ğŸ”´ LOGIN - Error:', error);
                console.error('ğŸ”´ LOGIN - Error stack:', error.stack);
                tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;">Eroare la Ã®ncÄƒrcare</td></tr>';
            }
        }
        window.addEventListener('DOMContentLoaded', () => {
            const saved = localStorage.getItem('superparty_user');
            if (saved) {
                try {
                console.log('ğŸ” LOGIN - Email:', email);
                console.log('ğŸ” LOGIN - Backend URL:', BACKEND_URL);
                    currentUser = JSON.parse(saved);
                    document.getElementById('welcomeText').textContent = currentUser.name || currentUser.email;
                    const role = (currentUser.role || '').toLowerCase();
                    if (role === 'admin') {
                        showPage('admin');
                        loadAdminData();
                    } else if (role === 'gm') {
                        showPage('gm');
                    } else if (!currentUser.kyc_status) {
                        showPage('kyc');
                    } else {
                        showPage('dashboard');
                    }
                } catch (e) {
                    localStorage.removeItem('superparty_user');
                }
            }
        });
    </script>
</body>
</html>
