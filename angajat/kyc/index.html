<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>KYC Onboarding â€“ SuperParty</title>

<style>
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
  background:#0f172a;
  color:#f1f5f9;
  padding:40px;
}
.kyc-container{
  max-width:1200px;
  margin:auto;
  background:rgba(15,23,42,.92);
  border-radius:30px;
  padding:50px;
  border:2px solid #334155;
}
.section{
  background:rgba(15,23,42,.85);
  border:2px solid #334155;
  border-radius:20px;
  padding:30px;
  margin-bottom:30px;
}
.upload-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
  gap:20px;
}
.upload-card{
  background:rgba(30,41,59,.6);
  border:2px dashed #475569;
  border-radius:16px;
  padding:30px;
  text-align:center;
  cursor:pointer;
}
.upload-card input{display:none}
.checkbox-large{
  display:flex;
  gap:15px;
  align-items:center;
  background:rgba(30,41,59,.6);
  padding:20px;
  border-radius:16px;
  border:2px solid #475569;
}
.btn{
  width:100%;
  padding:18px;
  background:linear-gradient(135deg,#667eea,#764ba2);
  border-radius:9999px;
  color:white;
  font-size:18px;
  margin-top:20px;
  cursor:pointer;
  border:none;
}
.btn:disabled{opacity:.5;cursor:not-allowed}
.contract-box{
  margin-top:15px;
  padding:20px;
  border-radius:16px;
  border:2px solid #475569;
  background:rgba(15,23,42,.9);
  max-height:260px;
  overflow-y:auto;
  font-size:14px;
}
#minorSection{display:none}
#driverDocs{display:none}
</style>
</head>

<body>
<div class="kyc-container">
  <h1 style="font-size:40px;margin-bottom:30px;">ðŸªª KYC Onboarding</h1>

  <!-- CONTRACT -->
  <div class="section">
    <h2>ðŸ“„ Contract de colaborare</h2>
    <div class="contract-box">
      <strong>CONTRACT DE COLABORARE ARTISTICÄ‚ È˜I TEHNICÄ‚</strong><br><br>
      BENEFICIAR: <strong>Micul Om Mare SRL</strong>, CUI 42279262<br>
      COLABORATOR: datele tale din buletin.<br><br>
      Prin semnare confirmi acceptarea tuturor clauzelor (exclusivitate, AI, rÄƒspundere).
    </div>

    <label class="checkbox-large" style="margin-top:15px;">
      <input type="checkbox" id="contractSignCheck">
      <span>Confirm cÄƒ am citit È™i semnez electronic contractul</span>
    </label>
  </div>

  <!-- DOCUMENTE -->
  <div class="section">
    <h2>ðŸ‘¤ Documente identitate</h2>
    <div class="upload-grid">
      <label class="upload-card">
        ðŸªª<br><strong>Buletin (faÈ›Äƒ)</strong>
        <input type="file" id="idFront" accept="image/*">
      </label>
      <label class="upload-card">
        ðŸ¤³<br><strong>Selfie cu buletin</strong>
        <input type="file" id="selfie" accept="image/*">
      </label>
    </div>
  </div>

  <!-- MINOR -->
  <div class="section" id="minorSection">
    <h2>ðŸ§’ Acord parental</h2>
    <p style="color:#facc15;margin-bottom:15px;">
      EÈ™ti minor. Acordul parental este obligatoriu.
    </p>
    <label class="upload-card">
      ðŸ“„<br><strong>Acord parental semnat</strong>
      <input type="file" id="parentConsent" accept="image/*,.pdf">
    </label>
  </div>

  <!-- È˜OFER -->
  <div class="section">
    <h2>ðŸš— OpÈ›ional â€“ È˜ofer</h2>
    <label class="checkbox-large">
      <input type="checkbox" id="driverCheck">
      <span>Doresc sÄƒ fiu È™i È™ofer</span>
    </label>

    <div id="driverDocs" style="margin-top:20px;">
      <div class="upload-grid">
        <label class="upload-card">
          ðŸªª<br><strong>Permis</strong>
          <input type="file" id="license" accept="image/*">
        </label>
        <label class="upload-card">
          ðŸ“„<br><strong>Cazier</strong>
          <input type="file" id="record" accept="image/*">
        </label>
      </div>
    </div>
  </div>

  <button class="btn" onclick="submitKYC()">ðŸš€ Trimite KYC</button>
</div>

<script>
const BACKEND_URL = 'https://script.google.com/macros/s/AKfycbwpScVyziDaoVeuxcqdBQ3qx6j-QHy5FYoWtvlqMSsu15eXGI_l5fmo1Bg8zqP1BLyJ/exec';

function isMinorFromCnp(cnp){
  if(!cnp||cnp.length<13) return false;
  const s=cnp[0];
  const prefix=s<3?'19':s<5?'18':'20';
  const year=parseInt(prefix+cnp.substr(1,2));
  const month=parseInt(cnp.substr(3,2))-1;
  const day=parseInt(cnp.substr(5,2));
  const dob=new Date(year,month,day);
  const now=new Date();
  let age=now.getFullYear()-year;
  if(now.getMonth()<month||(now.getMonth()==month&&now.getDate()<day)) age--;
  return age<18;
}

document.getElementById('driverCheck').addEventListener('change',e=>{
  document.getElementById('driverDocs').style.display=e.target.checked?'block':'none';
});

async function submitKYC(){
  const sign=document.getElementById('contractSignCheck');
  if(!sign.checked){alert('SemneazÄƒ contractul');return;}

  let user;
  try{user=JSON.parse(localStorage.getItem('superparty_user'));}catch(e){}
  if(!user||!user.email){
    alert('RelogheazÄƒ-te');
    window.location.href='../index.html';
    return;
  }

  let backendOk=false;
  try{
    const url=`${BACKEND_URL}?action=completeKYC&email=${encodeURIComponent(user.email)}`;
    const r=await fetch(url);
    const j=await r.json();
    if(j&&j.success){backendOk=true; user=j.user||user;}
  }catch(e){}

  user.kyc_status=true;
  user.contract_signed=true;
  localStorage.setItem('superparty_user',JSON.stringify(user));

  alert('âœ… KYC finalizat');
  window.location.href='../index.html';
}
</script>
</body>
</html>
