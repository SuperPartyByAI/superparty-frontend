<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>SuperParty - Autentificare</title>
<style>
/* SUPERPARTY AUTH CSS */
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
}

.login-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    max-width: 1200px;
    width: 100%;
    background: white;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
}

.login-brand {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 60px 40px;
    position: relative;
}

.logo {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 30px;
}

.logo-icon {
    font-size: 3rem;
    animation: bounce 2s infinite;
}

.login-brand h1 {
    font-size: 2.2rem;
}

.login-brand p {
    margin-top: 10px;
    line-height: 1.5;
    max-width: 360px;
}

@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

.login-form-container {
    padding: 60px 50px;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.form-header h2 {
    font-size: 1.8rem;
    margin-bottom: 5px;
}

.form-header p {
    color: #666;
    margin-bottom: 25px;
}

.form-group {
    margin-bottom: 18px;
}

label {
    display: block;
    margin-bottom: 6px;
    font-size: 0.95rem;
    color: #444;
}

input {
    width: 100%;
    padding: 12px 14px;
    border: 1px solid #ddd;
    border-radius: 12px;
    font-size: 1rem;
    transition: border 0.3s ease, box-shadow 0.3s ease;
}

input:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
    outline: none;
}

.btn-primary {
    width: 100%;
    padding: 14px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 1.05rem;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-top: 5px;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
}

.btn-primary:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

.link-button {
    background: none;
    border: none;
    padding: 0;
    margin: 0;
    font: inherit;
    color: #667eea;
    cursor: pointer;
    text-decoration: underline;
}

.form-footer {
    margin-top: 16px;
    font-size: 0.9rem;
    color: #555;
}

.form-footer p {
    margin-bottom: 6px;
}

.small-link {
    font-size: 0.85rem;
}

.hidden {
    display: none;
}

.alert {
    padding: 12px 16px;
    border-radius: 8px;
    margin-bottom: 15px;
    font-size: 0.9rem;
}

.alert-error {
    background: #fee;
    border: 1px solid #fcc;
    color: #c33;
}

.alert-success {
    background: #d4edda;
    border: 1px solid #c3e6cb;
    color: #155724;
}

/* Responsive */
@media (max-width: 900px) {
    .login-container {
        grid-template-columns: 1fr;
        max-width: 500px;
    }

    .login-brand {
        padding: 40px 30px;
        text-align: center;
    }

    .login-brand p {
        max-width: 100%;
        margin: 10px auto 0;
    }

    .login-form-container {
        padding: 40px 30px 30px;
    }
}

@media (max-width: 500px) {
    .login-container {
        border-radius: 0;
        box-shadow: none;
    }
}
</style>
</head>
<body>

<div class="login-container">
    <div class="login-brand">
        <div class="logo">
            <div class="logo-icon">üéâ</div>
            <h1>SuperParty</h1>
        </div>
        <p>Bine ai venit √Æn panoul SuperParty! Aici gestionezi petreceri, rezervƒÉri »ôi distrac»õia micilor invita»õi.</p>
    </div>

    <div class="login-form-container">
        <div class="form-header">
            <h2 id="form-title">Autentificare</h2>
            <p id="form-subtitle">IntrƒÉ √Æn contul tƒÉu SuperParty.</p>
        </div>

        <div id="alert-container"></div>

        <!-- LOGIN FORM -->
        <form id="login-form">
            <div class="form-group">
                <label for="login-email">Email</label>
                <input type="email" id="login-email" placeholder="exemplu@email.com" required />
            </div>
            <div class="form-group">
                <label for="login-password">ParolƒÉ</label>
                <input type="password" id="login-password" placeholder="Introdu parola" required />
            </div>
            <div class="form-footer small-link">
                <button type="button" class="link-button" data-target="forgot">»öi-ai uitat parola?</button>
            </div>
            <button type="submit" class="btn-primary">AutentificƒÉ-te</button>
            <div class="form-footer">
                <p>Test rapid: <button type="button" class="link-button" onclick="quickLogin()">Login GM Test</button></p>
            </div>
        </form>

        <!-- REGISTER FORM -->
        <form id="register-form" class="hidden">
            <div class="form-group">
                <label for="register-name">Nume complet</label>
                <input type="text" id="register-name" placeholder="Nume »ôi prenume" required />
            </div>
            <div class="form-group">
                <label for="register-email">Email</label>
                <input type="email" id="register-email" placeholder="exemplu@email.com" required />
            </div>
            <div class="form-group">
                <label for="register-password">ParolƒÉ</label>
                <input type="password" id="register-password" placeholder="Alege o parolƒÉ" required />
            </div>
            <div class="form-group">
                <label for="register-password-confirm">ConfirmƒÉ parola</label>
                <input type="password" id="register-password-confirm" placeholder="Reintrodu parola" required />
            </div>
            <button type="submit" class="btn-primary">CreeazƒÉ cont</button>
            <div class="form-footer">
                <p>Ai deja cont? <button type="button" class="link-button" data-target="login">AutentificƒÉ-te</button></p>
            </div>
        </form>

        <!-- FORGOT PASSWORD FORM -->
        <form id="forgot-form" class="hidden">
            <div class="form-group">
                <label for="forgot-email">Email</label>
                <input type="email" id="forgot-email" placeholder="Introdu emailul tƒÉu" required />
            </div>
            <p class="small-link" style="margin-bottom: 12px; color:#666;">√é»õi vom trimite instruc»õiuni de resetare a parolei.</p>
            <button type="submit" class="btn-primary">Trimite link</button>
            <div class="form-footer">
                <p><button type="button" class="link-button" data-target="login">√énapoi la autentificare</button></p>
            </div>
        </form>
    </div>
</div>

<script>
// =============== CONFIG ==================
const BACKEND_URL = 'https://script.google.com/macros/s/AKfycbxpV3NKZJLzNe5tTGX5TlUVnAQc1j6z82kPz7QkzartJpFfdPgvvg0T84ay1Ljlrxk/exec';

// ================== HELPERE =================
async function callApi(action, payload) {
    const params = new URLSearchParams({ action, ...payload });
    const response = await fetch(`${BACKEND_URL}?${params}`);
    
    if (!response.ok) {
        throw new Error('Eroare la server.');
    }
    
    return response.json();
}

function showAlert(message, type = 'error') {
    const container = document.getElementById('alert-container');
    const alertClass = type === 'success' ? 'alert-success' : 'alert-error';
    container.innerHTML = `<div class="alert ${alertClass}">${message}</div>`;
    
    setTimeout(() => {
        container.innerHTML = '';
    }, 5000);
}

// =============== SCHIMBARE FORMULARE ===============
const loginForm = document.getElementById('login-form');
const registerForm = document.getElementById('register-form');
const forgotForm = document.getElementById('forgot-form');
const formTitle = document.getElementById('form-title');
const formSubtitle = document.getElementById('form-subtitle');

function showForm(type) {
    loginForm.classList.add('hidden');
    registerForm.classList.add('hidden');
    forgotForm.classList.add('hidden');
    document.getElementById('alert-container').innerHTML = '';

    if (type === 'login') {
        loginForm.classList.remove('hidden');
        formTitle.textContent = 'Autentificare';
        formSubtitle.textContent = 'IntrƒÉ √Æn contul tƒÉu SuperParty.';
    } else if (type === 'register') {
        registerForm.classList.remove('hidden');
        formTitle.textContent = 'CreeazƒÉ cont';
        formSubtitle.textContent = 'CreeazƒÉ un cont nou.';
    } else if (type === 'forgot') {
        forgotForm.classList.remove('hidden');
        formTitle.textContent = 'Recuperare parolƒÉ';
        formSubtitle.textContent = 'RecupereazƒÉ-»õi parola.';
    }
}

document.querySelectorAll('.link-button[data-target]').forEach(btn => {
    btn.addEventListener('click', () => {
        showForm(btn.getAttribute('data-target'));
    });
});

// ================== LOGIN ==================
loginForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const email = document.getElementById('login-email').value.trim();
    const password = document.getElementById('login-password').value;
    
    if (!email || !password) {
        showAlert('Te rog introdu emailul »ôi parola.');
        return;
    }
    
    try {
        const result = await callApi('login', { email, password });
        
        if (result.success && result.user) {
            showAlert('‚úÖ Autentificare reu»ôitƒÉ!', 'success');
            
            // Save user to localStorage
            localStorage.setItem('superparty_user', JSON.stringify(result.user));
            
            // Redirect based on role
            setTimeout(() => {
                const role = result.user.role;
                if (role === 'gm') {
                    window.location.href = 'gm/gm-core.html';
                } else if (role === 'angajat') {
                    window.location.href = 'angajat/angajat-evenimente.html';
                } else {
                    window.location.href = 'dashboard.html';
                }
            }, 1000);
            
        } else {
            showAlert(result.error || 'Email sau parolƒÉ incorectƒÉ.');
        }
    } catch (err) {
        console.error(err);
        showAlert('A apƒÉrut o eroare. √éncearcƒÉ din nou.');
    }
});

// ================== QUICK LOGIN ==================
function quickLogin() {
    document.getElementById('login-email').value = 'admin@test.ro';
    document.getElementById('login-password').value = 'admin123';
    loginForm.dispatchEvent(new Event('submit'));
}

// ================== REGISTER ==================
registerForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const name = document.getElementById('register-name').value.trim();
    const email = document.getElementById('register-email').value.trim();
    const password = document.getElementById('register-password').value;
    const passwordConfirm = document.getElementById('register-password-confirm').value;
    
    if (!name || !email || !password) {
        showAlert('Te rog completeazƒÉ toate c√¢mpurile.');
        return;
    }
    
    if (password !== passwordConfirm) {
        showAlert('Parolele nu coincid.');
        return;
    }
    
    try {
        const result = await callApi('createUser', { 
            newName: name, 
            newEmail: email, 
            newPassword: password,
            newRole: 'angajat'
        });
        
        if (result.success) {
            showAlert('‚úÖ Cont creat! Te po»õi autentifica acum.', 'success');
            setTimeout(() => showForm('login'), 2000);
        } else {
            showAlert(result.error || 'Nu am putut crea contul.');
        }
    } catch (err) {
        console.error(err);
        showAlert('A apƒÉrut o eroare la crearea contului.');
    }
});

// ================== FORGOT PASSWORD ==================
forgotForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const email = document.getElementById('forgot-email').value.trim();
    
    if (!email) {
        showAlert('Te rog introdu emailul.');
        return;
    }
    
    showAlert('DacƒÉ existƒÉ un cont cu acest email, vei primi instruc»õiuni.', 'success');
    setTimeout(() => showForm('login'), 2000);
});

console.log('üîê SuperParty Auth loaded!');
</script>

</body>
</html>
